<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUMBO é‡ç‹è¨ˆæ™‚å™¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #1a1a2e; color: #ffffff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { background-color: #16213e; border: 1px solid #0f3460; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); } 
        
        .btn-primary { background-color: #e94560; border-color: #e94560; }
        .btn-primary:hover { background-color: #c73e52; }
        
        .filter-btn { 
            border: 1px solid #0f3460; 
            color: #a0a0a0; 
            background-color: #16213e;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        .filter-btn.active { 
            background-color: #4cc9f0; 
            color: #000; 
            font-weight: bold; 
            border-color: #4cc9f0;
        }
        .filter-btn:hover { color: #fff; border-color: #4cc9f0; }

        .text-blue { color: #4cc9f0; }
        .text-orange { color: #f72585; }
        .text-red { color: #ff0000; text-shadow: 0 0 8px rgba(255, 0, 0, 0.5); }
        .channel-badge-all { background-color: #f72585 !important; color: white !important; border: none !important; }
        
        .time-label { color: #8892b0; font-size: 0.85em; }
        .time-value { color: #ffffff; font-weight: bold; }
    </style>
</head>
<body>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-white m-0">ğŸ† DUMBO é‡ç‹è¨ˆæ™‚å™¨</h2>
        <button onclick="triggerMaintenance()" class="btn btn-danger border-light">
            âš ï¸ ç¶­è­·å¾Œé‡ç”Ÿ
        </button>
    </div>

    <div class="card p-4 mb-4">
        <div class="row g-2">
            <div class="col-md-5">
                <select id="bossSelect" class="form-select bg-dark text-white border-secondary">
                    <option value="" disabled selected>-- è«‹é¸æ“‡ BOSS --</option>
                    <option value="ç´…å¯¶ç‹">ğŸŒ ç´…å¯¶ç‹ (23m ~ 30m)</option>
                    <option value="æ¨¹å¦–ç‹">ğŸŒ³ æ¨¹å¦–ç‹ (23m ~ 30m)</option>
                    <option value="æ®­å±çŒ´ç‹">ğŸ’ æ®­å±çŒ´ç‹ (38m ~ 45m)</option>
                    <option value="å·¨å±…èŸ¹">ğŸ¦€ å·¨å±…èŸ¹ (45m ~ 1h)</option>
                    <option value="å†¥ç•Œå¹½éˆ">ğŸ‘» å†¥ç•Œå¹½éˆ (45m ~ 1h)</option>
                    <option value="é›ªæ¯›æ€ªäºº">ğŸ‘£ é›ªæ¯›æ€ªäºº (45m ~ 1h8m)</option>
                    <option value="å’•å’•é˜">ğŸ¦‰ å’•å’•é˜ (1h8m ~ 1h30m)</option>
                    <option value="å·¨å¤§æ·±å±±äººè”˜">ğŸ¥• å·¨å¤§æ·±å±±äººè”˜ (1h ~ 2h15m)</option>
                    <option value="æ²¼æ¾¤å·¨é±·">ğŸŠ æ²¼æ¾¤å·¨é±· (1h30m ~ 1h45m)</option>
                    <option value="å„é‹æ­»ç¥">ğŸ’€ å„é‹æ­»ç¥ (45m ~ 1h45m)</option>
                    <option value="è‚¯å¾·ç†Š">ğŸ» è‚¯å¾·ç†Š (1h53m ~ 2h8m)</option>
                    <option value="è‰¾åˆ©å‚‘">ğŸ¦ è‰¾åˆ©å‚‘ (1h58m ~ 2h8m)</option>
                    <option value="å–µZå®¢">ğŸ± å–µZå®¢ (2h ~ 7h)</option>
                    <option value="å–µæ€ªä»™äºº">ğŸ˜º å–µæ€ªä»™äºº (2h30m ~ 2h50m)</option>
                    <option value="æ›¸ç”Ÿå¹½éˆ">ğŸ“œ æ›¸ç”Ÿå¹½éˆ (2h30m ~ 5h)</option>
                    <option value="ä»™äººå¨ƒå¨ƒ">ğŸ§¸ ä»™äººå¨ƒå¨ƒ (2h38m ~ 3h)</option>
                    <option value="é›ªå±±é­”å¥³">ğŸ§™â€â™€ï¸ é›ªå±±é­”å¥³ (2h38m ~ 3h)</option>
                    <option value="æ®­å±è˜‘è‡ç‹">ğŸ§Ÿ æ®­å±è˜‘è‡ç‹ (3h15m ~ 3h45m)</option>
                    <option value="è˜‘è‡ç‹">ğŸ„ è˜‘è‡ç‹ (3h30m ~ 4h)</option>
                    <option value="ä¹å°¾å¦–ç‹">ğŸ¦Š ä¹å°¾å¦–ç‹ (3h30m ~ 9h30m)</option>
                    <option value="æµ·æ€’æ–¯(å·¦)">ğŸŸ æµ·æ€’æ–¯(å·¦) (3h ~ 5h)</option>
                    <option value="æµ·æ€’æ–¯(å³)">ğŸ¡ æµ·æ€’æ–¯(å³) (3h ~ 5h)</option>
                    <option value="è‘›é›·é‡‘å‰›">ğŸ¦ è‘›é›·é‡‘å‰› (4h30m ~ 5h50m)</option>
                    <option value="å·´æ´›è°·">ğŸ˜ˆ å·´æ´›è°· (6h45m ~ 9h)</option>
                    <option value="é»‘è¼ªç‹">ğŸ¢ é»‘è¼ªç‹ (13h ~ 17h)</option>
                    <option value="è—è‡è‡ç‹">ğŸ”µ è—è‡è‡ç‹ (16h40m ~ 31h20m)</option>
                </select>
            </div>
            <div class="col-md-4">
                <input type="number" id="channelInput" class="form-control bg-dark text-white border-secondary" placeholder="è¼¸å…¥é »é“ (ä¾‹å¦‚ 1527)">
            </div>
            <div class="col-md-3">
                <button onclick="addRecord()" class="btn btn-primary w-100 fw-bold">âš”ï¸ ç™»è¨˜æ“Šæ®º</button>
            </div>
        </div>
    </div>

    <div class="mb-3 d-flex flex-wrap" id="filterContainer">
        <button class="btn filter-btn active rounded-pill px-3" onclick="filterData('all', this)">ğŸ“Œ å…¨éƒ¨</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('ç´…å¯¶ç‹', this)">ğŸŒ ç´…å¯¶ç‹</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('æ¨¹å¦–ç‹', this)">ğŸŒ³ æ¨¹å¦–ç‹</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('æ®­å±çŒ´ç‹', this)">ğŸ’ çŒ´ç‹</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('å·¨å±…èŸ¹', this)">ğŸ¦€ å·¨å±…èŸ¹</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('å†¥ç•Œå¹½éˆ', this)">ğŸ‘» å¹½éˆ</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('é›ªæ¯›æ€ªäºº', this)">ğŸ‘£ é›ªæ¯›</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('å’•å’•é˜', this)">ğŸ¦‰ å’•å’•é˜</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('å·¨å¤§æ·±å±±äººè”˜', this)">ğŸ¥• äººè”˜</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('æ²¼æ¾¤å·¨é±·', this)">ğŸŠ é±·é­š</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('å„é‹æ­»ç¥', this)">ğŸ’€ æ­»ç¥</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('è‚¯å¾·ç†Š', this)">ğŸ» è‚¯å¾·ç†Š</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('è‰¾åˆ©å‚‘', this)">ğŸ¦ è‰¾åˆ©å‚‘</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('å–µZå®¢', this)">ğŸ± å–µZå®¢</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('å–µæ€ªä»™äºº', this)">ğŸ˜º å–µä»™äºº</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('æ›¸ç”Ÿå¹½éˆ', this)">ğŸ“œ æ›¸ç”Ÿ</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('ä»™äººå¨ƒå¨ƒ', this)">ğŸ§¸ ä»™äºº</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('é›ªå±±é­”å¥³', this)">ğŸ§™â€â™€ï¸ å†°é­”å¥³</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('æ®­å±è˜‘è‡ç‹', this)">ğŸ§Ÿ æ®­å±è˜‘</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('è˜‘è‡ç‹', this)">ğŸ„ è˜‘è‡ç‹</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('ä¹å°¾å¦–ç‹', this)">ğŸ¦Š ä¹å°¾</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('æµ·æ€’æ–¯(å·¦)', this)">ğŸŸ æµ·(å·¦)</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('æµ·æ€’æ–¯(å³)', this)">ğŸ¡ æµ·(å³)</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('è‘›é›·é‡‘å‰›', this)">ğŸ¦ é‡‘å‰›</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('å·´æ´›è°·', this)">ğŸ˜ˆ å·´æ´›è°·</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('é»‘è¼ªç‹', this)">ğŸ¢ é»‘è¼ªç‹</button>
        <button class="btn filter-btn rounded-pill px-3" onclick="filterData('è—è‡è‡ç‹', this)">ğŸ”µ è—è‡è‡</button>
    </div>

    <div id="bossList" class="row">
        <div class="text-center text-white">æ­£åœ¨è¼‰å…¥è³‡æ–™...</div>
    </div>
</div>

<script>
    // âš ï¸ è«‹ç¢ºèªé€™è£¡æ˜¯ä½  Render çš„æ–°å¾Œç«¯ç¶²å€
    // const API_URL = "https://dumbo-boss-timer-xxxx.onrender.com"; 
    // å¦‚æœä½ å·²ç¶“æ”¹éäº†ï¼Œè«‹ä¿ç•™ä½ çš„ï¼Œä¸è¦è¢«æˆ‘é€™è¡Œè“‹æ‰
    
    // ğŸ‘‡ ç‚ºäº†æ–¹ä¾¿ä½ è¤‡è£½è²¼ä¸Šï¼Œæˆ‘é€™è£¡å…ˆå¯«æˆæœƒè‡ªå‹•æŠ“å–ç•¶å‰ç¶²å€çš„é‚è¼¯ (å¦‚æœæ˜¯éƒ¨ç½²åœ¨ä¸€èµ·çš„è©±)
    // ä½†å› ç‚ºæˆ‘å€‘æ˜¯åˆ†é–‹éƒ¨ç½²ï¼Œæ‰€ä»¥ä½ é‚„æ˜¯è¦ç¢ºèªä¸€ä¸‹ä¸Šé¢é‚£è¡Œ const API_URL æ˜¯å¦æ­£ç¢º
    // å¦‚æœä½ ä¹‹å‰å·²ç¶“æ”¹æˆæ­£ç¢ºçš„ Render ç¶²å€ï¼Œè«‹ç¹¼çºŒç”¨é‚£ä¸€è¡Œï¼
    
    // å¦‚æœä½ æ‡¶å¾—æ‰¾ï¼Œè«‹æŠŠä¸‹é¢é€™è¡Œå–æ¶ˆè¨»è§£ï¼Œä¸¦å¡«å…¥æ­£ç¢ºç¶²å€
    // const API_URL = "https://ä½ çš„å°ˆæ¡ˆå.onrender.com";
    
    // é€™è£¡æˆ‘å…ˆç”¨ä¸€å€‹è®Šæ•¸æ¥ï¼Œé¿å…å ±éŒ¯ï¼Œè«‹å‹™å¿…ç¢ºèªä½ çš„ index.html ç¬¬ 255 è¡Œå·¦å³æ˜¯æ­£ç¢ºçš„ç¶²å€
    if (typeof API_URL === 'https://dumbo-api.onrender.com') {
        console.error("è«‹è¨˜å¾—è¨­å®š API_URLï¼");
    }

    let allRecords = []; 
    let currentFilter = 'all'; 

    async function loadData() {
        try {
            const response = await fetch(`${API_URL}/bosses`);
            allRecords = await response.json(); 
            renderList();

        } catch (error) {
            console.error("è¼‰å…¥å¤±æ•—:", error);
            document.getElementById("bossList").innerHTML = `<div class="text-danger text-center">ç„¡æ³•é€£ç·šåˆ°ä¼ºæœå™¨ ğŸ˜­</div>`;
        }
    }

    function renderList() {
        const listContainer = document.getElementById("bossList");
        listContainer.innerHTML = ""; 

        const filteredData = currentFilter === 'all' 
            ? allRecords 
            : allRecords.filter(item => item.boss_name === currentFilter);

        if (filteredData.length === 0) {
            listContainer.innerHTML = `<div class="col-12 text-center text-white py-5 fs-5">
                æ²’æœ‰ç¬¦åˆã€Œ${currentFilter === 'all' ? 'ä»»ä½•ç´€éŒ„' : currentFilter}ã€çš„è³‡æ–™ ğŸ‘»
            </div>`;
            return;
        }

        filteredData.forEach(item => {
            let colorClass = "text-secondary";
            if (item.color === "blue") colorClass = "text-blue";
            if (item.color === "orange") colorClass = "text-orange";
            if (item.color === "red") colorClass = "text-red";

            const killDate = new Date(item.kill_time + "Z"); 
            const minDate = new Date(killDate.getTime() + item.min_mins * 60000); 
            const minTimeStr = minDate.toLocaleString('zh-TW', { hour: '2-digit', minute: '2-digit' });

            const maxDate = new Date(killDate.getTime() + item.max_mins * 60000);
            const maxTimeStr = maxDate.toLocaleString('zh-TW', { hour: '2-digit', minute: '2-digit' });

            let channelBadge = "";
            if (item.channel === -1) {
                channelBadge = `<span class="badge channel-badge-all fs-6">ğŸ“¢ å…¨éƒ¨é »é“</span>`;
            } else {
                channelBadge = `<span class="badge bg-light text-dark fs-6 border border-secondary">${item.channel} é »</span>`;
            }

            const cardHtml = `
                <div class="col-md-6 col-lg-4 mb-3 fade-in">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h4 class="card-title m-0 text-white">${item.img} ${item.boss_name}</h4>
                                ${channelBadge}
                            </div>
                            <h5 class="card-text ${colorClass} fw-bold mt-3">${item.status}</h5>
                            <hr class="border-secondary">
                            
                            <div class="d-flex justify-content-between mb-2">
                                <span class="time-label">ğŸš€ æœ€å¿«å‡ºç”Ÿ:</span>
                                <span class="time-value text-blue">${minTimeStr}</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span class="time-label">ğŸ¢ æœ€æ™šå‡ºç”Ÿ:</span>
                                <span class="time-value text-orange">${maxTimeStr}</span>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button onclick="resetRecord(${item.id})" class="btn btn-outline-light btn-sm w-100">ğŸ”„ å‰›æ®º</button>
                                <button onclick="deleteRecord(${item.id})" class="btn btn-outline-danger btn-sm w-100">ğŸ—‘ï¸ åˆªé™¤</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            listContainer.innerHTML += cardHtml;
        });
    }

    function filterData(bossName, btnElement) {
        currentFilter = bossName;
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        btnElement.classList.add('active');
        renderList();
    }

    async function addRecord() {
        const bossName = document.getElementById("bossSelect").value;
        const channel = document.getElementById("channelInput").value;

        if (!bossName || !channel) {
            alert("è«‹é¸æ“‡ç‹ä¸¦è¼¸å…¥é »é“ï¼");
            return;
        }

        try {
            const response = await fetch(`${API_URL}/bosses`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ boss_name: bossName, channel: parseInt(channel) })
            });

            if (response.ok) {
                document.getElementById("channelInput").value = "";
                await loadData(); 
            } else {
                alert("æ–°å¢å¤±æ•—");
            }
        } catch (error) {
            console.error("éŒ¯èª¤:", error);
            alert("é€£ç·šéŒ¯èª¤");
        }
    }

    async function deleteRecord(id) {
        try {
            const response = await fetch(`${API_URL}/bosses/${id}`, { method: "DELETE" });
            if (response.ok) {
                await loadData(); 
            } else {
                alert("åˆªé™¤å¤±æ•—");
            }
        } catch (error) {
            alert("é€£ç·šéŒ¯èª¤");
        }
    }

    async function resetRecord(id) {
        try {
            const response = await fetch(`${API_URL}/bosses/${id}/reset`, { method: "PUT" });
            if (response.ok) {
                await loadData(); 
            } else {
                alert("æ›´æ–°å¤±æ•—");
            }
        } catch (error) {
            alert("é€£ç·šéŒ¯èª¤");
        }
    }

    async function triggerMaintenance() {
        if (!confirm("å°‡æœƒå°‡å…¨éƒ¨å¡ç‰‡åˆªé™¤ï¼Œé‡æ–°è¨˜éŒ„å…¨é »ç‹æ™‚é–“ï¼Œæ˜¯å¦åŸ·è¡Œ?")) return;
        try {
            const response = await fetch(`${API_URL}/maintenance/reset`, { method: "POST" });
            if (response.ok) {
                alert("ç¶­ä¿®é‡ç½®å®Œæˆï¼å…¨é »è¨ˆæ™‚é–‹å§‹ï¼");
                currentFilter = 'all'; 
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.filter-btn:first-child').classList.add('active');
                await loadData();
            } else {
                alert("é‡ç½®å¤±æ•—");
            }
        } catch (error) {
            console.error(error);
            alert("é€£ç·šéŒ¯èª¤");
        }
    }

    loadData();
    setInterval(loadData, 30000);

</script>
</body>
</html>